@startuml Aria - Deployment Diagram

!define NODE_COLOR #E3F2FD
!define ARTIFACT_COLOR #BBDEFB
!define DATABASE_COLOR #FFF9C4

title Aria API - Diagrama de Despliegue (Deployment Architecture)

skinparam node {
    BackgroundColor NODE_COLOR
    BorderColor #1976D2
    FontSize 12
}

skinparam artifact {
    BackgroundColor ARTIFACT_COLOR
    BorderColor #0D47A1
    FontSize 11
}

skinparam database {
    BackgroundColor DATABASE_COLOR
    BorderColor #F57F17
    FontSize 11
}

' ====== NODO PRINCIPAL - SPRING BOOT APPLICATION ======
node "**Spring Boot Application**\n<<Execution Environment>>" as spring_boot {
    
    ' --- Tomcat Embedded ---
    artifact "**Tomcat 10.1.26**\n<<Application Server>>" as tomcat {
        component "**REST API**\nPort: 8080\nContext Path: /\nSpring MVC DispatcherServlet" as rest_api
    }
    
    ' --- Application Layer ---
    artifact "**Application Layer**\n<<Business Logic>>" as app_layer {
        component "Controllers (4)" as controllers
        component "Services (4)" as services
        component "Repositories (3)" as repositories
        component "DTOs & Mappers" as dtos
        component "Exception Handlers" as exceptions
    }
    
    ' --- Configuration ---
    artifact "**Configuration**\n<<Spring Boot>>" as config {
        component "application.properties" as props
        component "Logging (SLF4J/Logback)" as logging
        component "Bean Configuration" as beans
    }
    
    ' --- Data Loader ---
    artifact "**Data Loader**\n<<CommandLineRunner>>" as loader {
        component "JSON Parser\n(Jackson)" as json_parser
    }
}

' ====== BASE DE DATOS H2 (In-Memory) ======
database "**H2 Database**\n<<In-Memory>>\njdbc:h2:mem:excusesdb\nMode: MySQL\nConsole: /h2-console" as h2 #DATABASE_COLOR

' ====== ARCHIVOS DE DATOS JSON ======
folder "**JSON Data Files**\ndocs/json/" as json_files #E1BEE7 {
    artifact "murphy.json" as murphy
    artifact "hofstadter.json" as hofstadter
    artifact "dilbert.json" as dilbert
    artifact "devops_principles.json" as devops
    artifact "dev_axioms.json" as axioms
    artifact "memes_argentinos.json" as memes_arg
    artifact "argento-memes.json" as argento
    artifact "dev-memes.json" as dev_memes
}

' ====== CLIENTE HTTP (Externos) ======
actor "**API Consumers**" as clients #FFE0B2
note right of clients
    - Postman
    - cURL
    - Web Browsers
    - Mobile Apps
    - Other Services
end note

' ====== SWAGGER UI ======
artifact "**Swagger UI**\n/swagger-ui.html\nOpenAPI 3.0" as swagger #C5E1A5

' ====== RELACIONES Y FLUJOS ======

' Clientes -> REST API
clients --> rest_api : "HTTP Requests\n(GET, POST, PUT, DELETE)"
clients --> swagger : "Browse API Docs"
swagger --> rest_api : "Interactive Testing"

' REST API -> Application Layer
rest_api --> controllers : "dispatches"
controllers --> services : "delegates to"
services --> repositories : "uses"

' Application -> DTOs/Exceptions
controllers --> dtos : "maps to/from"
controllers --> exceptions : "handles errors"

' Application -> Configuration
app_layer --> config : "configured by"
app_layer --> logging : "logs to console"

' Repositories -> H2
repositories --> h2 : "JPA/Hibernate\nCRUD Operations"

' Data Loader -> JSON -> H2
loader --> json_files : "reads on startup"
loader --> h2 : "populates\n224 entities"

' ====== NOTAS TÃ‰CNICAS ======
note top of spring_boot
    **Runtime Environment**
    - Java 17 (Temurin)
    - Spring Boot 3.2.8
    - Maven 3.9.9
    - Spring Data JPA
    - Lombok 1.18.34
end note

note bottom of h2
    **Database Details**
    - Driver: org.h2.Driver
    - URL: jdbc:h2:mem:excusesdb
    - Username: sa
    - Password: (empty)
    - Console enabled: true
    - Initial data: 224 records
      * 97 Laws
      * 87 Memes
      * 40 Fragments
end note

note right of rest_api
    **API Endpoints**
    /api/excuses/random
    /api/excuses/daily
    /api/excuses/role/{role}
    /api/excuses/meme
    /api/excuses/law
    /api/excuses/ultra
    /api/fragments/**
    /api/memes/**
    /api/laws/**
end note

note left of json_files
    **Data Loading Strategy**
    - Loaded once at startup
    - CommandLineRunner execution
    - Transactional operations
    - Error handling with logs
end note

' ====== DEPLOYMENT SPECS ======
note bottom of spring_boot
    **Deployment Characteristics**
    - Self-contained JAR (Fat JAR)
    - No external container needed
    - H2 in-memory (no persistence)
    - Embedded Tomcat server
    - Zero external dependencies for runtime
    - Ideal for development/testing
end note

@enduml
